import{r as s,A as N,_ as S,j as e,u as D,a as P,b as C,T as M}from"./index-_tGX61Hg.js";import{A as E}from"./AppSpin-C7d-5P7N.js";import{u as I}from"./index-BMMfHKV0.js";import{u as O}from"./index-1O09-V8y.js";var F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};const k=F;var H=function(n,c){return s.createElement(N,S({},n,{ref:c,icon:k}))};const L=s.forwardRef(H);function T({children:i}){return e.jsx("main",{className:"container mx-auto py-3 flex flex-col items-center justify-center h-screen",children:i})}function b({title:i,isSignUp:n,onSubmit:c,onFlip:f}){const[r,u]=s.useState(""),[d,m]=s.useState(""),[h,p]=s.useState(""),o=()=>{u(""),m(""),p("")},x=t=>{t.preventDefault(),c(r,d),o()},l=t=>{t.preventDefault(),f(),o()};return e.jsx(e.Fragment,{children:e.jsxs("section",{className:"card card-body flex-initial bg-base-100 shadow-xl",children:[e.jsx("h3",{className:"app-title-3 text-center mb-3",children:i}),e.jsx("input",{type:"text",className:"input mb-3",placeholder:"Логин",value:r,onChange:t=>u(t.target.value)}),e.jsx("input",{placeholder:"Пароль",className:"input mb-3",value:d,onChange:t=>m(t.target.value),type:"password"}),n&&e.jsx("input",{className:"input mb-3",placeholder:"Повторить пароль",value:h,onChange:t=>p(t.target.value),type:"password"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{className:"btn btn-primary",onClick:x,children:n?"Зарегистрироваться":"Войти"}),e.jsx("button",{className:"btn btn-link",onClick:l,children:n?"Логин":"Регистрация"})]})]})})}function U(){const[i,n]=s.useState(!1),[c,f]=s.useState(!1),[r,u]=s.useState(null),{isAuth:d,signIn:m,signUp:h}=I(),p=O(a=>a.user),{showNotification:o}=D(),[x,l]=s.useState(!1),t=P();s.useEffect(()=>{window.addEventListener("beforeinstallprompt",u),f(A()!=="browser")},[]),s.useEffect(()=>{d&&(p.role==="admin"?location.href=C:t(M))},[d,p,t]);async function v(a,g){try{l(!0),await m(a,g),o({message:"Вы успешно вошли!",type:"success"})}catch(w){o({message:w.message,type:"error"})}finally{l(!1)}}async function y(a,g){try{l(!0),await h(a,g),o({message:"Вы успешно зарегистрировались!",type:"success"})}catch(w){o({message:w.message,type:"error"})}finally{l(!1)}}async function j(){if(r){r.prompt();const{outcome:a}=await r.userChoice;a==="accepted"&&u(null)}}function A(){const a=window.matchMedia("(display-mode: standalone)").matches;return document.referrer.startsWith("android-app://")?"twa":navigator.standalone||a?"standalone":"browser"}return e.jsxs(T,{children:[e.jsx(E,{spinning:x}),i?e.jsx(b,{title:"Регистрация",isSignUp:!0,onFlip:()=>n(!1),onSubmit:y}):e.jsx(b,{title:"Добро пожаловать в GEO App!",onFlip:()=>n(!0),onSubmit:v}),!c&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("button",{className:"btn btn-outline",onClick:j,children:[e.jsx(L,{})," Установить"]})})]})}export{U as default};
